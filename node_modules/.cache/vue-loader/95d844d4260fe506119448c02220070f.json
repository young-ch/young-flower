{"remainingRequest":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/src/apps/user/UserDetail.vue?vue&type=style&index=0&id=289bcdc8&lang=scss&","dependencies":[{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/src/apps/user/UserDetail.vue","mtime":1665531625451},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/css-loader/dist/cjs.js","mtime":1665531751068},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1665531752098},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/postcss-loader/src/index.js","mtime":1665531751243},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/sass-loader/dist/cjs.js","mtime":1665531751056},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/cache-loader/dist/cjs.js","mtime":1665531750829},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/vue-loader/lib/index.js","mtime":1665531752006}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgouZHJvcHpvbmUtY3VzdG9tLWNvbnRlbnQgewogIHRleHQtYWxpZ246IGNlbnRlcjsKfQoKLmRyb3B6b25lLWN1c3RvbS10aXRsZSB7CiAgbWFyZ2luLXRvcDogMDsKICBjb2xvcjogIzAwYjc4MjsKfQoKLy8uc3VidGl0bGUgewogIC8vY29sb3I6ICNmZmY7Ci8vfQoKLmRyb3B6b25lIHsKICAvL21pbi1oZWlnaHQ6MjAwcHg7CiAgLy9tYXgtaGVpZ2h0OjIwMHB4OwogIGJhY2tncm91bmQtY29sb3I6ICMxNTI5MzUgIWltcG9ydGFudDsKfQoKCg=="},{"version":3,"sources":["UserDetail.vue"],"names":[],"mappings":";;AAmiBA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"UserDetail.vue","sourceRoot":"src/apps/user","sourcesContent":["<template>\n  <div>\n    <v-card class=\"my-2\">\n      <v-card-title>회원 정보</v-card-title>\n      <v-card-text>\n        <v-form ref=\"userForm\">\n          <v-row>\n\n            <v-col cols=\"12\" md=\"6\">\n\n              <div class=\"d-flex\">\n                <v-col sm=\"4\">\n                  <vue-dropzone\n                    ref=\"userPhotoDropzone\"\n                    id=\"dropzone\"\n                    :style=\"'background-color: #ffffff !important;'\"\n                    :options=\"dropzoneOptions\"\n                    :useCustomSlot=\"true\"\n                    @vdropzone-success=\"dropzoneUploadSuccess\"\n                    @vdropzone-removed-file=\"dropzoneRemove\"\n                    @vdropzone-processing=\"dropzoneProcessing\"\n                  >\n                    <div v-if=\"user.photoFile\">\n                      <v-badge\n                        bordered\n                        dark\n                        color=\"black\"\n                        icon=\"mdi-delete\"\n                        @click.native=\"dropzoneRemove\"\n                      >\n  <!--                      overlap-->\n\n                        <!--                    <v-img :src=\"`${user.photoFile}`\" position=\"center center\"/>-->\n                        <v-img :src=\"`${attachmentPath}/user/photo/${user.photoFile}`\" max-width=\"150\"/>\n                      </v-badge>\n                    </div>\n                    <div v-if=\"!user.photoFile && attachmentImages.length === 0\" class=\"dropzone-custom-content\">\n                      <h3 class=\"dropzone-custom-title\">회원 사진</h3>\n                      <div class=\"subtitle\">Drag and drop or click to select a file from your computer</div>\n                    </div>\n                  </vue-dropzone>\n                </v-col>\n\n                <v-col class=\"mgr\" sm=\"8\">\n                  <v-text-field label=\"로그인 아이디\"\n                                v-model=\"user.loginId\"\n                                ref=\"loginId\"\n                                maxlength=\"50\"\n                                :rules=\"[rules.common.required, rules.common.loginId]\"\n                                @keydown.enter=\"isUniqueLoginId(user.loginId)\"\n                                @input=\"value => user.loginId = value.toLowerCase()\"\n                                @blur=\"isUniqueLoginId(user.loginId)\"\n                                :success-messages=\"message.success\"\n                                :error-messages=\"message.error\"\n                  />\n                  <v-text-field label=\"로그인 패스워드\" v-model=\"user.loginPw\" :rules=\"[passwordRequired]\" maxlength=\"120\"\n                                :type=\"decryptLoginPw ? 'text' : 'password'\"\n                                :append-icon=\"decryptLoginPw? 'mdi-eye' : 'mdi-eye-off'\"\n                                @click:append=\"decryptLoginPw = !decryptLoginPw\"\n                  />\n                  <v-text-field label=\"패스워드 확인\" v-model=\"confirmPassword\" :rules=\"[passwordRequired, passwordCompare]\" maxlength=\"120\"\n                                :type=\"decryptLoginConfirmPw ? 'text' : 'password'\"\n                                :append-icon=\"decryptLoginConfirmPw? 'mdi-eye' : 'mdi-eye-off'\"\n                                @click:append=\"decryptLoginConfirmPw = !decryptLoginConfirmPw\"\n                  />\n\n                  <v-combobox\n                      v-model=\"userHasRoles\"\n                      :items=\"roles\"\n                      item-text=\"roleName\"\n                      item-value=\"id\"\n                      label=\"역할\"\n                      multiple\n                      required\n                      :rules=\"[rules.common.required]\"\n                    ></v-combobox>\n\n                  <v-select :items=\"states\" item-value=\"value\" item-text=\"text\" v-model=\"user.state\"\n                            :rules=\"[rules.common.required]\"\n                            label=\"회원상태\"\n                            required />\n                  <v-textarea\n                    v-model=\"user.withdrawReason\"\n                    v-if=\"user.state === 'STATE_WITHDRAW'\"\n                    class=\"px-2 py-1\"\n                    solo-inverted\n                    flat\n                    placeholder=\"탈퇴사유\"\n                    hide-details\n                  ></v-textarea>\n                </v-col>\n\n              </div>\n\n              <v-row>\n                <v-col cols=\"12\" md=\"12\" class=\"d-flex\" style=\"margin-top: -50px\">\n<!--                  <v-switch v-model=\"user.agreedClause\" label=\"약관 동의\" :value=\"true\" :false-value=\"false\" style=\"padding-right: 20px\"/>-->\n<!--                  <v-switch v-model=\"user.agreedPersonalInformation\" label=\"개인정보 수집 및 이용에 동의\" :value=\"true\" :false-value=\"false\" style=\"padding-right: 20px\"/>-->\n\n    <!--              <v-switch v-model=\"user.isAgreedMailReceive\" label=\"이메일 수신 동의\" :value=\"true\" :false-value=\"false\" style=\"padding-right: 20px\"/>-->\n    <!--              <v-switch v-model=\"user.isAgreedSmsReceive\" label=\"SMS 수신 동의\" :value=\"true\" :false-value=\"false\"  style=\"padding-right: 20px\"/>-->\n    <!--              <v-switch v-model=\"user.isAgreedPushReceive\" label=\"Push 수신 동의\" :value=\"true\" :false-value=\"false\"   style=\"padding-right: 20px\"/>-->\n    <!--              <v-switch v-model=\"user.isAgreedInfoNotify\" label=\"정보 알림 동의\" :value=\"true\" :false-value=\"false\"   style=\"padding-right: 20px\"/>-->\n    <!--              <v-switch v-model=\"user.manager\" label=\"관리자\" :value=\"true\" :false-value=\"false\" />-->\n                </v-col>\n\n              </v-row>\n\n            </v-col>\n\n            <v-col cols=\"12\" md=\"6\">\n\n\n              <v-text-field label=\"이름\" v-model=\"user.name\" :rules=\"[rules.common.required]\" maxlength=\"120\"/>\n              <v-text-field label=\"닉네임\" v-model=\"user.nickname\" maxlength=\"120\"/>\n\n              <v-text-field label=\"이메일\" v-model=\"user.email\" ref=\"email\" :rules=\"[rules.common.required, rules.common.email]\" maxlength=\"120\"\n                            @keydown.enter=\"isUniqueEmail(user.email)\"\n                            @blur=\"isUniqueEmail(user.email)\"\n                            :error-messages=\"message.errorEmail\" :success-messages=\"message.successEmail\"\n              />\n              <v-text-field label=\"연락처\" v-model=\"user.mobileNo\" :rules=\"[rules.common.required, rules.common.mobile]\" maxlength=\"50\"\n                            @keydown.enter=\"isUniqueMobile(user.mobileNo)\"\n                            @blur=\"isUniqueMobile(user.mobileNo)\"\n                            :error-messages=\"message.errorMobile\" :success-messages=\"message.successMobile\"\n              />\n\n              <v-menu\n                ref=\"birth\"\n                v-model=\"birth\"\n                :close-on-content-click=\"false\"\n                transition=\"scale-transition\"\n                offset-y\n                min-width=\"290px\"\n              >\n                <template v-slot:activator=\"{ on, attrs }\">\n                  <v-text-field\n                    v-model=\"user.birthDate\"\n                    label=\"생년월일\"\n                    v-bind=\"attrs\"\n                    v-on=\"on\"\n                    :rules=\"[rules.common.birth]\"\n                    maxlength=\"10\"\n                  ></v-text-field>\n                </template>\n                <v-date-picker\n                  ref=\"picker\"\n                  v-model=\"user.birthDate\"\n                  :max=\"new Date().toISOString().substr(0, 10)\"\n                  min=\"1900-01-01\"\n                  @change=\"changeBirth\"\n                  locale=\"ko\"\n                ></v-date-picker>\n              </v-menu>\n\n  <!--            <v-text-field label=\"직위\" v-model=\"user.position\" maxlength=\"120\"/>-->\n\n\n  <!--            <v-radio-group v-model=\"user.gender\" label=\"성별\" row>-->\n  <!--              <v-radio label=\"남\" value=\"M\"></v-radio>-->\n  <!--              <v-radio label=\"여\" value=\"F\"></v-radio>-->\n  <!--            </v-radio-group>-->\n\n\n  <!--            clearable-->\n\n  <!--            <v-select :items=\"roles\" item-value=\"value\" item-text=\"text\" v-model=\"user.roleId\"-->\n  <!--                      :rules=\"[rules.common.required]\"-->\n  <!--                      label=\"회원권한\"-->\n  <!--                      required />-->\n\n            </v-col>\n\n  <!--          <v-col cols=\"12\" md=\"12\" class=\"d-flex\" style=\"margin-top: -50px\">-->\n  <!--            <v-text-field v-model=\"user.zipCode\" label=\"우편번호 검색\"-->\n  <!--                          @click=\"openZipCode\"-->\n  <!--                          @focus.once=\"openZipCode\"-->\n  <!--                          v-on:keyup.13=\"openZipCode\"-->\n  <!--                          maxlength=\"6\"-->\n  <!--                          :rules=\"[-->\n  <!--                            rules.common.required,-->\n  <!--                            rules.common.zipcode-->\n  <!--                            ]\"-->\n  <!--                          style=\"max-width: 120px; padding-right: 10px\"-->\n  <!--            />-->\n  <!--            <v-text-field v-model=\"user.address\" :rules=\"[rules.common.required]\" label=\"주소\" style=\" padding-right: 10px\"/>-->\n  <!--            <v-text-field v-model=\"user.addressDetail\" label=\"주소상세\" ref=\"addressDetail\"/>-->\n\n  <!--            <v-dialog v-model=\"daumDialogVisible\" max-width=\"500px\" @click:outside=\"daumDialogVisible=false\" @keydown.esc=\"daumDialogVisible=false\">-->\n  <!--              <daum-post @complete=\"completeZipCode\" />-->\n  <!--            </v-dialog>-->\n  <!--          </v-col>-->\n  <!--          -->\n\n  <!--          <v-col cols=\"12\" md=\"12\" class=\"d-flex\" style=\"margin-top: -50px\">-->\n  <!--          </v-col>-->\n\n          </v-row>\n\n        </v-form>\n      </v-card-text>\n\n    </v-card>\n\n    <div class=\"d-flex align-center\">\n      <v-spacer></v-spacer>\n      <v-btn color=\"red\" @click=\"deleteUser\" v-if=\"user.id && user.id != null\" dark>\n        <v-icon left>mdi mdi-delete</v-icon>\n        삭제</v-btn>\n      <v-btn color=\"indigo\" @click=\"save\" style=\"margin-left:1rem\" dark>\n        <v-icon left>mdi mdi-content-save</v-icon>\n        저장</v-btn>\n      <v-btn @click=\"$router.push(listLink)\" style=\"margin-left:1rem\">\n        <v-icon left>mdi mdi-format-list-bulleted</v-icon>\n        목록</v-btn>\n    </div>\n  </div>\n</template>\n\n<script>\nimport rules from \"@/utils/rules\";\nimport UserApi from \"@/api/UserApi\";\nimport RoleApi from \"@/api/RoleApi\";\nimport config from \"@/configs\";\nimport _ from \"lodash\";\n\nimport vue2Dropzone from 'vue2-dropzone'\nimport 'vue2-dropzone/dist/vue2Dropzone.min.css'\n\n\nexport default {\n  name:'userForm',\n  props:['id'],\n  components: {\n    vueDropzone: vue2Dropzone\n  },\n  data: () => ({\n    listLink:'/users',\n    attachmentPath:process.env.VUE_APP_ATTACH_FILE_SERVER_URL,\n    user: {\n      flowerCompany: {}\n    },\n    userHasRoles:[],\n    date: '1990-10-09',\n    birth: false,\n    gender: 'male',\n    daumDialogVisible: false,\n    companyDialogVisible: false,\n    rules,\n    confirmPassword: null,\n    states:config.meta.user.state,\n    systems:config.meta.systems,\n    roles:[], //config.meta.user.role,\n    isModify:false,\n    message:{\n      error:'',\n      errorEmail:'',\n      errorSystem:null,\n      success:'',\n      successEmail:'',\n    },\n    decryptLoginPw: false,\n    decryptLoginConfirmPw: false,\n    originUser: {},\n    // dropzoneOptions: {\n    //   url: `${process.env.VUE_APP_GW_URL}/files/1/USER/upload`,\n    //   thumbnailHeight: 110,\n    //   thumbnailWidth: 140,\n    //   maxFilesize: 10, // mb\n    //   maxFiles: 2,\n    //   // acceptedFileTypes: \"image/*\",\n    //   acceptedFiles: \"image/*\",\n    //   headers: {\n    //     'Authorization': `bearer ${this?.$store?.getters?.[\"user/token\"] ?? ''}`\n    //   },\n    //   uploadMultiple: false,\n    //   clickable: true,\n    //   addRemoveLinks: true\n    // },\n    attachmentImages: []\n  }),\n  watch: {\n    birth (val) {\n      val && setTimeout(() => (this.$refs.picker.activePicker = 'YEAR'))\n    }\n  },\n  computed: {\n    dropzoneOptions() {\n      return {\n        url: `${process.env.VUE_APP_GW_URL}/users/user/upload/image`,\n        thumbnailHeight: 110,\n        thumbnailWidth: 140,\n        maxFilesize: 10, // mb\n        maxFiles: 2,\n        // acceptedFileTypes: \"image/*\",\n        acceptedFiles: \"image/*\",\n        headers: {\n          'Authorization': `bearer ${this?.$store?.getters?.[\"user/token\"] ?? ''}`\n        },\n        uploadMultiple: false,\n        clickable: true,\n        addRemoveLinks: true\n      }\n    },\n    passwordCompare() {\n      return () => (!this.user.loginPw && !this.confirmPassword) || (this.user.loginPw === this.confirmPassword) || '패스워드가 일치하지 않습니다.'\n    },\n    passwordRequired() {\n      // return true;\n      return value => (!!value || this.isModify) || '필수 입력 항목입니다..'\n    }\n  },\n  methods: {\n    openCompany() {\n      this.companyDialogVisible = true;\n    },\n    doneCompanySelector(data) {\n      this.user.flowerCompanyId = data ? data.id : null\n      this.user.flowerCompany.companyName = data ? data.companyName : ''\n      // this.user.flowerCompany.id = data ? data.id : ''\n\n      setTimeout(() => {\n      }, 50);\n\n      this.companyDialogVisible = false;\n\n    },\n    dropzoneUploadSuccess(uploadedFileInfo, res) {\n\n      // this.user.photoFile = res[0].publishedUri\n      const acceptedFiles = this.$refs.userPhotoDropzone.getAcceptedFiles();\n      if(acceptedFiles && acceptedFiles.length > 1) {\n        this.$refs.userPhotoDropzone.removeFile(acceptedFiles[0]);\n\n      }\n      // this.$refs.userPhotoDropzone.removeAllFiles();\n\n      // console.log(res)\n      // console.log(uploadedFileInfo)\n      // this.attachmentImages = [...this.attachmentImages, ...res.map(r => {return {'fileId' : r.id, 'uuid' : uploadedFileInfo.upload.uuid}})]\n      // this.attachmentImages = [...res.map(r => {return {'fileId' : r.id, 'uuid' : uploadedFileInfo.upload.uuid}})]\n      this.attachmentImages = [{'savedName' : res.saveName, 'uuid' : uploadedFileInfo.upload.uuid}]\n\n    },\n    dropzoneProcessing() {\n      this.$refs.userPhotoDropzone.setOption('headers', {Authorization: `bearer ${sessionStorage.getItem(\"X-Token\") ?? ''}`})\n    },\n    dropzoneRemove(f) {\n      this.user.photoFile = null;\n      this.attachmentImages = this.attachmentImages.filter(a => a.uuid !== f.upload.uuid);\n    },\n    uploadedRemove(fileId) {\n      this.user.photoFile = null;\n      this.attachmentImages = this.attachmentImages.filter(f => f.fileId !== fileId);\n    },\n    async isUniqueLoginId(loginId) {\n      this.message.success = null;\n      this.message.error = null;\n\n      if(loginId) {\n        const isUsed = await UserApi.existLoginId(loginId); //.then((existed) => existed.data)\n\n        if (isUsed && (this.isModify ? this.originUser.loginId !== loginId : true)) {\n          this.message.error = '이미 사용중인 아이디입니다.';\n          return false;\n        }\n        this.message.success = '사용 가능한 아이디입니다.';\n        return true;\n      }\n\n      return true;\n    },\n    async isUniqueEmail(email) {\n\n      this.message.errorEmail = null;\n      this.message.successEmail = null;\n\n      if(email && (!this.isModify || email !== this.originUser.email)) {\n\n        const isUsed = await UserApi.existEmail(email); //.then((existed) => existed.data)\n\n        if (isUsed) {\n          this.message.errorEmail = '이미 사용중인 이메일 주소입니다.';\n          return false;\n        }\n        this.message.errorEmail = null;\n        this.message.successEmail = '사용 가능한 주소입니다.';\n        return true;\n      }\n\n      return true;\n    },\n    async isUniqueMobile(mobile) {\n\n      this.message.errorMobile = null;\n      this.message.successMobile = null;\n\n      if(mobile && (!this.isModify || mobile !== this.originUser.mobileNo)) {\n\n        const isUsed = await UserApi.existMobile(mobile); //.then((existed) => existed.data)\n\n        if (isUsed) {\n          this.message.errorMobile = '이미 사용중인 연락처 번호입니다.';\n          return false;\n        }\n        this.message.errorMobile = null;\n        this.message.successMobile = '사용 가능한 번호입니다.';\n        return true;\n      }\n\n      return true;\n    },\n    async save() {\n\n      const valid = [await this.isUniqueLoginId(this.user.loginId), await this.isUniqueEmail(this.user.email), await this.isUniqueMobile(this.user.mobileNo), await this.$refs.userForm.validate()];\n\n      // const valid = [await this.isUniqueEmail(this.user.email), await this.$refs.userForm.validate()];\n      if(valid.indexOf(false) !== -1) {\n        window.scrollTo(0,50)\n        alert(\"필수 입력 항목을 확인해주세요.\")\n        return\n      }\n\n      this.user.authorities = null\n      // console.log(this.attachmentImages)\n      this.user.photoFile = this.attachmentImages?.map(a => a.savedName)?.[0]??null\n      // const clonedRoles = _.cloneDeep(this.user.userHasRoles);\n\n      this.user.userHasRoles = this.userHasRoles?.map(r => r.id)??[]\n\n      UserApi.save(this.user).then(() => {\n        this.user.loginPw = null;\n        this.confirmPassword = null;\n        alert('저장되었습니다.')\n        this.$refs.userForm.resetValidation()\n        this.$router.push(this.listLink)\n        // this.$router.push({path: `/users/detail`})\n      }).catch(e => {\n        console.log(e)\n        alert(e)\n      })\n    },\n    deleteUser() {\n      if (confirm('삭제하시겠습니까?'))\n        UserApi.delete(this.user.id).then(() => {\n          alert('삭제되었습니다.')\n          this.$router.push({path: this.listLink})\n        })\n    },\n    changeBirth (date) {\n      // console.log(date);\n      this.$refs.birth.save(date)\n    },\n    openZipCode() {\n      this.daumDialogVisible = true;\n    },\n    completeZipCode(data) {\n      this.user.zipCode = data.zonecode\n      this.user.address = data.address\n      setTimeout(() => {\n        this.$refs.addressDetail.focus();\n      }, 50);\n      this.daumDialogVisible = false;\n\n    },\n    get() {\n\n      RoleApi.getRoles().then(data => {\n        this.roles = data\n      })\n\n      if(this.id) {\n        UserApi.get(this.id).then(data => {\n          // data.loginPw = null;\n          this.user = data;\n          // console.log(this.user.flowerCompany)\n          if(!this.user.flowerCompany)\n            this.user.flowerCompany = {}\n\n          this.user.loginPw = null;\n          this.userHasRoles = this.user.userHasRoles?.map(r => {\n            return {\n              'roleName':r.role.roleName,\n              'id':r.role.id\n            }\n          })??[]\n          // this.user.userHasRoles = this.user.userHasRoles?.map(r => r.role.id)??[]\n          this.originUser = _.cloneDeep(data);\n          this.isModify = true;\n\n          this.attachmentImages = this.user.photoFile ? [{'savedName' : this.user.photoFile}] : []\n        })\n      }\n\n    }\n  },\n  created() {\n    this.get();\n\n    let storedParams = this.$store.getters?.params??{};\n    if(storedParams && storedParams.pageName) {\n      this.pageName = storedParams.pageName\n\n      if(storedParams.pageName === '관리자') {\n        this.userHasRoles = [{'roleName' : storedParams.pageName, 'id': 2}]\n        this.listLink = '/users/roles/2'\n      } else if(storedParams.pageName === '일반 회원') {\n        this.userHasRoles = [{'roleName' : storedParams.pageName, 'id': 100}]\n        this.listLink = '/users/roles/100'\n      } else if(storedParams.pageName === '탈퇴 회원') {\n        this.userHasRoles = [{'roleName' : storedParams.pageName, 'id': 100}]\n        this.listLink = '/users/states/STATE_WITHDRAW'\n      } else if(storedParams.pageName === '신청 회원') {\n        this.userHasRoles = [{'roleName' : storedParams.pageName, 'id': 100}]\n        this.listLink = '/users/states/STATE_APPROVAL_REQUEST'\n      }\n\n    }\n    // console.log(storedParams)\n  }\n}\n</script>\n<style lang=\"scss\">\n\n  .dropzone-custom-content {\n    text-align: center;\n  }\n\n  .dropzone-custom-title {\n    margin-top: 0;\n    color: #00b782;\n  }\n\n  //.subtitle {\n    //color: #fff;\n  //}\n\n  .dropzone {\n    //min-height:200px;\n    //max-height:200px;\n    background-color: #152935 !important;\n  }\n\n\n</style>\n"]}]}