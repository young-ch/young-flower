{"remainingRequest":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/src/apps/popup/Popup.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/src/apps/popup/Popup.vue","mtime":1665531625451},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/cache-loader/dist/cjs.js","mtime":1665531750829},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/babel-loader/lib/index.js","mtime":1665531751248},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/cache-loader/dist/cjs.js","mtime":1665531750829},{"path":"/Users/youngchelchoi/Desktop/workspace/flower/flower-backoffice/node_modules/vue-loader/lib/index.js","mtime":1665531752006}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBQb3B1cEFwaSBmcm9tICcuLi8uLi9hcGkvUG9wdXBBcGknOwppbXBvcnQgUG9wdXBDYXRlZ29yeUFwaSBmcm9tICcuLi8uLi9hcGkvUG9wdXBDYXRlZ29yeUFwaSc7CmltcG9ydCBydWxlcyBmcm9tICJAL3V0aWxzL3J1bGVzIjsKaW1wb3J0IF8gZnJvbSAibG9kYXNoIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOidwb3B1cCcsCiAgY29tcG9uZW50czp7CiAgfSwKICBkYXRhKCl7CiAgICByZXR1cm57CiAgICAgIGJyZWFkY3J1bWJzOiBbCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+2MneyXheq0gOumrCcsCiAgICAgICAgICBkaXNhYmxlZDogZmFsc2UsCiAgICAgICAgICBocmVmOiAnIycKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICftjJ3sl4XrqqnroZ0nCiAgICAgICAgfQogICAgICBdLAogICAgICBydWxlcywKICAgICAgYXR0YWNobWVudFBhdGg6cHJvY2Vzcy5lbnYuVlVFX0FQUF9BVFRBQ0hfRklMRV9TRVJWRVJfVVJMLAogICAgICBzZWFyY2hLZXl3b3JkOicnLAogICAgICBoZWFkZXJzOiBbCiAgICAgICAge3RleHQ6ICfrtoTrpZgnLCB2YWx1ZTogJ2NhdGVnb3J5TmFtZScsIGFsaWduOiAnbGVmdCd9LAogICAgICAgIHt0ZXh0OiAn7KCc66qpJywgdmFsdWU6ICd0aXRsZScsIGFsaWduOiAnbGVmdCd9LAogICAgICAgIHt0ZXh0OiAn7IKs7Jqp7Jes67aAJywgdmFsdWU6ICdhY3RpdmF0ZWQnfSwKICAgICAgICB7dGV4dDogJ+uTseuhneydvCcsIHZhbHVlOiAnY3JlYXRlZEF0J30sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+q0gOumrCcsCiAgICAgICAgICB2YWx1ZTogJ2FjdGlvbnMnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlCiAgICAgICAgfQogICAgICBdLAogICAgICBjYXRlZ29yeUhlYWRlcjogWwogICAgICAgIHt0ZXh0OiAn7Lm07YWM6rOg66asIOuqhScsIHZhbHVlOiAnY2F0ZWdvcnlOYW1lJywgYWxpZ246ICdsZWZ0Jywgc29ydGFibGU6IHRydWV9LAogICAgICAgIC8vIHt0ZXh0OiAn7IOd7ISx7J28JywgdmFsdWU6ICdjcmVhdGVkQXQnLCBzb3J0YWJsZTogZmFsc2V9LAogICAgICAgIC8vIHt0ZXh0OiAn7IKs7Jqp7Jes67aAJywgdmFsdWU6ICdpc0FjdGl2YXRlZCcsIHNvcnRhYmxlOiB0cnVlfSwKICAgICAgICB7dGV4dDogJ+q0gOumrCcsIHZhbHVlOiAnYWN0aW9ucycsIHNvcnRhYmxlOiBmYWxzZX0KICAgICAgXSwKICAgICAgb3B0aW9uczp7fSwKICAgICAgc2luZ2xlU2VsZWN0OiB0cnVlLAogICAgICBzZWxlY3RlZDogW10sCiAgICAgIGRhdGFzZXRzOltdLAogICAgICB0b3RhbEl0ZW1zOm51bGwsCiAgICAgIGRpYWxvZyA6IGZhbHNlLAogICAgICBwb3B1cENhdGVnb3J5OnsKICAgICAgICBjYXRlZ29yeU5hbWU6bnVsbCwKICAgICAgfSwKICAgICAgcG9wdXBDYXRlZ29yaWVzOltdLAogICAgICBjaGVja0NhdGVnb3J5SWQ6LTEsCiAgICAgIHNlbGVjdGVkQ2F0ZWdvcnk6W10KICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBvcHRpb25zOiB7CiAgICAgIGhhbmRsZXIoKSB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRQYXJhbXMnLCB0aGlzLm9wdGlvbnMpOwogICAgICB9LAogICAgICBkZWVwOiB0cnVlLAogICAgfSwKICAgIHNlbGVjdGVkQ2F0ZWdvcnk6IHsKICAgICAgaGFuZGxlcihudikgewogICAgICAgIHRoaXMub3B0aW9ucy5jYXRlZ29yeUlkID0gbnY/LlswXT8uaWQ/P251bGw7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRQYXJhbXMnLCB0aGlzLm9wdGlvbnMpOwogICAgICB9CiAgICB9LAogICAgc2VhcmNoS2V5d29yZDogewogICAgICBoYW5kbGVyKG52KSB7CiAgICAgICAgdGhpcy5vcHRpb25zLnNlYXJjaEtleXdvcmQgPSBudjsKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFBhcmFtcycsIHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGNoYW5nZU9yZGVyKGUpIHsKICAgICAgY29uc3QgeyAgcGFnZSwgaXRlbXNQZXJQYWdlIH0gPSB0aGlzLm9wdGlvbnM7CiAgICAgIGNvbnN0IG5ld09yZGVyID0gdGhpcy5kYXRhc2V0cy5sZW5ndGggLSAocGFnZS0xKSppdGVtc1BlclBhZ2UgLSBlLm1vdmVkLm5ld0luZGV4OwoKICAgICAgUG9wdXBBcGkub3JkZXIoZS5tb3ZlZC5lbGVtZW50LmlkLCBuZXdPcmRlcikudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy5zZWFyY2goKTsKICAgICAgfSk7CiAgICB9LAogICAgc2VhcmNoKGNhdGVnb3J5SWQsIHN0b3JlZFBhcmFtcykgewoKICAgICAgUG9wdXBDYXRlZ29yeUFwaS5maW5kQWxsKCkudGhlbihyZXN1bHQgPT4gewogICAgICAgIHRoaXMucG9wdXBDYXRlZ29yaWVzID0gcmVzdWx0OwoKICAgICAgICBQb3B1cEFwaS5saXN0KGNhdGVnb3J5SWQpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICB0aGlzLmRhdGFzZXRzID0gZGF0YS5tYXAoYiA9PiB7CiAgICAgICAgICAgIGIuY2F0ZWdvcnlOYW1lID0gdGhpcy5wb3B1cENhdGVnb3JpZXMuZmluZChlID0+IGUuaWQgPT09IGIuY2F0ZWdvcnlJZCk/LmNhdGVnb3J5TmFtZT8/Jy0nCiAgICAgICAgICAgIHJldHVybiBiOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYoc3RvcmVkUGFyYW1zKSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHN0b3JlZFBhcmFtcwogICAgICAgICAgICB0aGlzLnNlYXJjaEtleXdvcmQgPSB0aGlzLm9wdGlvbnMuc2VhcmNoS2V5d29yZCA/IHRoaXMub3B0aW9ucy5zZWFyY2hLZXl3b3JkIDogbnVsbAogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKCiAgICB9LAoKICAgIHVwZGF0ZUZvcm0oaXRlbSkgewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7cGF0aDpgL3BvcHVwcy8ke2l0ZW0uaWR9L2Zvcm1gfSk7CiAgICB9LAoKICAgIGRlbGV0ZVBvcHVwKGl0ZW0pIHsKICAgICAgaWYoY29uZmlybSgn7IKt7KCc7ZWY7Iuc6rKg7Iq164uI6rmMPycpKSB7CiAgICAgICAgUG9wdXBBcGkuZGVsZXRlKGl0ZW0uaWQpLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy5zZWFyY2goKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvKiDsubTthYzqs6DrpqwgKi8KICAgIHNhdmVDYXRlZ29yeSh2YWx1ZSwgZGlhbG9nKSB7CiAgICAgIGlmICghdGhpcy4kcmVmcy5wb3B1cENhdGVnb3J5Q3JlYXRlRm9ybS52YWxpZGF0ZSgpKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgdGhpcy5wb3B1cENhdGVnb3J5LmNhdGVnb3J5TmFtZSA9IHZhbHVlOwogICAgICBQb3B1cENhdGVnb3J5QXBpLnNhdmUodGhpcy5wb3B1cENhdGVnb3J5KS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICBQb3B1cENhdGVnb3J5QXBpLmZpbmRBbGwoKS50aGVuKHJlc3VsdCA9PiB7CiAgICAgICAgICB0aGlzLnBvcHVwQ2F0ZWdvcmllcyA9IHJlc3VsdDsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnBvcHVwQ2F0ZWdvcnkuY2F0ZWdvcnlOYW1lID0gJyc7CiAgICAgICAgdGhpcy4kcmVmcy5wb3B1cENhdGVnb3J5Q3JlYXRlRm9ybS5yZXNldFZhbGlkYXRpb24oKQogICAgICB9KTsKCiAgICAgIGRpYWxvZy52YWx1ZSA9IGZhbHNlCiAgICB9LAoKICAgIHVwZGF0ZUNhdGVnb3J5KGNhdGVnb3J5LCBkaWFsb2cpIHsKICAgICAgaWYgKCF0aGlzLiRyZWZzLnBvcHVwQ2F0ZWdvcnlVcGRhdGVGb3JtLnZhbGlkYXRlKCkpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgUG9wdXBDYXRlZ29yeUFwaS5zYXZlKGNhdGVnb3J5KS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLnNlYXJjaCgpOwogICAgICB9KTsKCiAgICAgIGRpYWxvZy52YWx1ZSA9IGZhbHNlCiAgICB9LAoKICAgIGRlbGV0ZUNhdGVnb3J5KGRhdGEpIHsKICAgICAgaWYgKGNvbmZpcm0oJ+yCreygnCDtlZjsi5zqsqDsirXri4jquYw/JykpIHsKICAgICAgICBQb3B1cENhdGVnb3J5QXBpLmRlbGV0ZShkYXRhLmlkKS50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuc2VhcmNoKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgfSwKICBjcmVhdGVkKCkgewoKICAgIGxldCBzdG9yZWRQYXJhbXMgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzPy5wYXJhbXM/P3t9OwoKICAgIC8vIGZpcnN0IGxvYWQKICAgIGlmKCFzdG9yZWRQYXJhbXMubmFtZSB8fCBzdG9yZWRQYXJhbXMubmFtZSAhPT0gdGhpcy4kb3B0aW9ucy5uYW1lKSB7CiAgICAgIHRoaXMub3B0aW9ucyA9IHsKICAgICAgICBwYWdlOjEsCiAgICAgICAgaXRlbXNQZXJQYWdlOjEwLAogICAgICAgIGNhdGVnb3J5SWQ6bnVsbCwKICAgICAgICBuYW1lOnRoaXMuJG9wdGlvbnMubmFtZQogICAgICB9CgogICAgICBzdG9yZWRQYXJhbXMgPSB0aGlzLm9wdGlvbnMKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRQYXJhbXMnLCBzdG9yZWRQYXJhbXMpCgogICAgfSBlbHNlIHsKICAgICAgc3RvcmVkUGFyYW1zLm5hbWUgPSB0aGlzLiRvcHRpb25zLm5hbWUKICAgICAgdGhpcy5vcHRpb25zID0gc3RvcmVkUGFyYW1zCiAgICB9CgogICAgdGhpcy5zZWxlY3RlZENhdGVnb3J5ID0gdGhpcy5vcHRpb25zLmNhdGVnb3J5SWQgPyBbe2lkOnRoaXMub3B0aW9ucy5jYXRlZ29yeUlkfV0gOiBbXQogICAgdGhpcy5zZWFyY2godGhpcy5vcHRpb25zLmNhdGVnb3J5SWQsIF8uY2xvbmVEZWVwKHN0b3JlZFBhcmFtcykpCgogIH0KCn07Cg=="},{"version":3,"sources":["Popup.vue"],"names":[],"mappings":";AAwOA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA","file":"Popup.vue","sourceRoot":"src/apps/popup","sourcesContent":["<template>\n  <div class=\"d-flex flex-column flex-grow-1\">\n    <div class=\"d-flex align-center py-3\">\n      <div>\n        <div class=\"display-1\">팝업관리</div>\n        <v-breadcrumbs :items=\"breadcrumbs\" class=\"pa-0 py-2\"></v-breadcrumbs>\n      </div>\n      <v-spacer></v-spacer>\n      <v-btn color=\"primary\" @click=\"$router.push({path: `/popups/form`})\" style=\"margin-right:1rem\">\n        <v-icon left>mdi mdi-playlist-plus</v-icon>\n        팝업 추가\n      </v-btn>\n    </div>\n\n    <v-row>\n      <v-col md=\"3\">\n\n        <!-- category list -->\n        <v-card>\n          <v-card-title>카테고리</v-card-title>\n          <v-card-text>\n            <v-card-actions class=\"justify-end\">\n\n              <v-dialog\n                transition=\"dialog-top-transition\"\n                max-width=\"35rem\"\n              >\n                <template v-slot:activator=\"{ on, attrs }\">\n                  <v-btn\n                    color=\"primary\"\n                    v-bind=\"attrs\"\n                    v-on=\"on\"\n                    class=\"popupCategoryBtn\"\n                  ><v-icon left>mdi mdi-plus</v-icon>카테고리 추가</v-btn>\n                </template>\n\n                <template v-slot:default=\"dialog\">\n                  <v-card>\n                    <v-form ref=\"popupCategoryCreateForm\">\n                    <v-toolbar\n                      color=\"black\"\n                      dark\n                    >팝업 카테고리 등록</v-toolbar>\n                    <v-card-text>\n                      <v-text-field label=\"팝업카테고리\" v-model=\"popupCategory.categoryName\" :rules=\"[rules.common.required]\" maxlength=\"120\"/>\n                    </v-card-text>\n                    <v-card-actions class=\"justify-end\">\n                      <v-btn\n                        @click=\"saveCategory(popupCategory.categoryName, dialog);\"\n                        color=\"indigo\"\n                      ><v-icon left>mdi mdi-content-save</v-icon>추가</v-btn>\n                    </v-card-actions>\n                    </v-form>\n                  </v-card>\n\n                </template>\n              </v-dialog>\n\n            </v-card-actions>\n\n            <v-data-table\n              id=\"categoryTable\"\n              item-key=\"id\"\n              single-select\n              :hide-default-footer=\"true\"\n              disable-pagination\n              :headers=\"categoryHeader\"\n              :items=\"popupCategories\"\n              class=\"elevation-1\"\n              @click:row=\"(item, row) => {\n                row.select(!row.isSelected); search(row.isSelected ? null : item.id)\n              }\"\n              v-model=\"selectedCategory\"\n            >\n\n<!--              <template v-slot:item.createdAt=\"{ value }\">-->\n<!--                {{ value ? $moment(value).format('YYYY-MM-DD HH:mm:ss') : \"\" }}-->\n<!--              </template>-->\n              <template v-slot:item.isActivated=\"{ value }\">\n                {{ value ?'사용':'사용안함' }}\n              </template>\n              <template v-slot:item.actions=\"{ item }\">\n\n                <v-dialog\n                  transition=\"dialog-top-transition\"\n                  max-width=\"35rem\"\n                >\n                  <template v-slot:activator=\"{ on, attrs }\">\n                    <v-btn\n                      icon\n                      v-bind=\"attrs\"\n                      v-on=\"on\"\n                    >\n                      <v-icon small>mdi-pencil</v-icon>\n                    </v-btn>\n                  </template>\n                  <template v-slot:default=\"dialog\">\n                    <v-card>\n                      <v-form ref=\"popupCategoryUpdateForm\">\n                      <v-toolbar>\n                        팝업 카테고리 수정\n                      </v-toolbar>\n                      <v-card-text>\n\n                        {{ item.categoryName }}\n\n                        <v-text-field\n                          v-model=\"item.categoryName\"\n                          :rules=\"[rules.common.required]\"\n                          maxlength=\"120\"\n                        />\n\n                      </v-card-text>\n                      <v-card-actions class=\"justify-end\">\n\n                        <v-btn\n                          @click=\"updateCategory(item, dialog)\"\n                          color=\"indigo\"\n                        ><v-icon left>mdi mdi-content-save</v-icon>\n                          수정\n                        </v-btn>\n                      </v-card-actions>\n                      </v-form>\n                    </v-card>\n                  </template>\n                </v-dialog>\n                <v-btn\n                  icon\n                  @click.stop=\"deleteCategory(item)\"\n                >\n                  <v-icon small>mdi-delete</v-icon>\n                </v-btn>\n              </template>\n            </v-data-table>\n\n          </v-card-text>\n        </v-card>\n      </v-col>\n\n      <v-col md=\"9\">\n        <!--popup List-->\n        <v-card>\n          <v-card-title>\n            <v-card-title>팝업 목록</v-card-title>\n\n            <v-spacer></v-spacer>\n\n            <v-text-field label=\"검색\"\n                          append-icon=\"mdi-magnify\"\n                          v-model=\"searchKeyword\"\n                          class=\"flex-grow-1 mr-md-2\"\n                          hide-details\n                          dense\n                          clearable\n                          single-line/>\n\n    <!--      <v-text-field-->\n    <!--        v-model=\"search\"-->\n    <!--        append-icon=\"mdi-magnify\"-->\n    <!--        label=\"Search\"-->\n    <!--        single-line-->\n    <!--        hide-details-->\n    <!--      ></v-text-field>-->\n\n          </v-card-title>\n          <v-card-text>\n              <v-data-table\n                v-model=\"selected\"\n                :headers=\"headers\"\n                :items=\"datasets\"\n                item-key=\"id\"\n                :single-select=\"singleSelect\"\n                :search=\"searchKeyword\"\n                :footer-props=\"{showFirstLastPage: true, 'items-per-page-options' : [10,20,50,100,-1], showCurrentPage:true}\"\n                :options.sync=\"options\"\n                class=\"elevation-1\"\n              >\n                  <template v-slot:item.title=\"{ value, item }\">\n                    <div><router-link :to=\"{path:`/popups/${item.id}/form`}\">{{ value }}</router-link></div>\n                  </template>\n                  <template v-slot:item.activated=\"{ item }\">\n                    {{ item.activated ?'사용':'사용안함' }}\n                  </template>\n                  <template v-slot:item.createdAt=\"{ value }\">\n                    <div>{{ value | formatDate('YYYY-MM-DD HH:mm:ss') }}</div>\n                  </template>\n                  <template v-slot:item.actions=\"{ item }\">\n                    <v-icon\n                      small\n                      class=\"mr-2\"\n                      @click.stop=\"updateForm(item)\"\n                    >\n                      mdi-pencil\n                    </v-icon>\n                    <v-icon\n                      small\n                      @click.stop=\"deletePopup(item)\"\n                    >\n                      mdi-delete\n                    </v-icon>\n                  </template>\n                  <template #footer.page-text=\"props\">\n\n                    <v-combobox\n                      v-model=\"options.page\"\n                      :label=\"`${props.pageStart}-${props.pageStop} of ${props.itemsLength} rows / ${options.page} page / total ${Math.ceil(props.itemsLength / options.itemsPerPage)} pages`\"\n                      :items=\"Array.from({length: Math.ceil(props.itemsLength / options.itemsPerPage)}, (v, k) => k+1 )\"\n                      :return-object=\"false\"\n                      hide-details dense\n                      type=\"number\"\n                      suffix=\"page\"\n                    >\n                    </v-combobox>\n                  </template>\n              </v-data-table>\n          </v-card-text>\n        </v-card>\n\n        <div class=\"d-flex align-center py-3\">\n          <v-spacer></v-spacer>\n          <v-btn color=\"primary\" @click=\"$router.push({path: `/popup/form`})\" style=\"margin-right:1rem\">\n            <v-icon left>mdi mdi-playlist-plus</v-icon>\n            팝업 추가\n          </v-btn>\n        </div>\n      </v-col>\n    </v-row>\n\n  </div>\n</template>\n\n<script>\nimport PopupApi from '../../api/PopupApi';\nimport PopupCategoryApi from '../../api/PopupCategoryApi';\nimport rules from \"@/utils/rules\";\nimport _ from \"lodash\";\n\nexport default {\n  name:'popup',\n  components:{\n  },\n  data(){\n    return{\n      breadcrumbs: [\n        {\n          text: '팝업관리',\n          disabled: false,\n          href: '#'\n        },\n        {\n          text: '팝업목록'\n        }\n      ],\n      rules,\n      attachmentPath:process.env.VUE_APP_ATTACH_FILE_SERVER_URL,\n      searchKeyword:'',\n      headers: [\n        {text: '분류', value: 'categoryName', align: 'left'},\n        {text: '제목', value: 'title', align: 'left'},\n        {text: '사용여부', value: 'activated'},\n        {text: '등록일', value: 'createdAt'},\n        {\n          text: '관리',\n          value: 'actions',\n          sortable: false\n        }\n      ],\n      categoryHeader: [\n        {text: '카테고리 명', value: 'categoryName', align: 'left', sortable: true},\n        // {text: '생성일', value: 'createdAt', sortable: false},\n        // {text: '사용여부', value: 'isActivated', sortable: true},\n        {text: '관리', value: 'actions', sortable: false}\n      ],\n      options:{},\n      singleSelect: true,\n      selected: [],\n      datasets:[],\n      totalItems:null,\n      dialog : false,\n      popupCategory:{\n        categoryName:null,\n      },\n      popupCategories:[],\n      checkCategoryId:-1,\n      selectedCategory:[]\n    }\n  },\n  watch: {\n    options: {\n      handler() {\n        this.$store.commit('setParams', this.options);\n      },\n      deep: true,\n    },\n    selectedCategory: {\n      handler(nv) {\n        this.options.categoryId = nv?.[0]?.id??null;\n        this.$store.commit('setParams', this.options);\n      }\n    },\n    searchKeyword: {\n      handler(nv) {\n        this.options.searchKeyword = nv;\n        this.$store.commit('setParams', this.options);\n      }\n    }\n  },\n  methods: {\n    changeOrder(e) {\n      const {  page, itemsPerPage } = this.options;\n      const newOrder = this.datasets.length - (page-1)*itemsPerPage - e.moved.newIndex;\n\n      PopupApi.order(e.moved.element.id, newOrder).then(() => {\n        this.search();\n      });\n    },\n    search(categoryId, storedParams) {\n\n      PopupCategoryApi.findAll().then(result => {\n        this.popupCategories = result;\n\n        PopupApi.list(categoryId).then(data => {\n          this.datasets = data.map(b => {\n            b.categoryName = this.popupCategories.find(e => e.id === b.categoryId)?.categoryName??'-'\n            return b;\n          });\n\n          if(storedParams) {\n            this.options = storedParams\n            this.searchKeyword = this.options.searchKeyword ? this.options.searchKeyword : null\n          }\n        });\n      });\n\n    },\n\n    updateForm(item) {\n      this.$router.push({path:`/popups/${item.id}/form`});\n    },\n\n    deletePopup(item) {\n      if(confirm('삭제하시겠습니까?')) {\n        PopupApi.delete(item.id).then(() => {\n          this.search();\n        });\n      }\n    },\n\n    /* 카테고리 */\n    saveCategory(value, dialog) {\n      if (!this.$refs.popupCategoryCreateForm.validate()) {\n        return\n      }\n      this.popupCategory.categoryName = value;\n      PopupCategoryApi.save(this.popupCategory).then((result) => {\n        PopupCategoryApi.findAll().then(result => {\n          this.popupCategories = result;\n        });\n        this.popupCategory.categoryName = '';\n        this.$refs.popupCategoryCreateForm.resetValidation()\n      });\n\n      dialog.value = false\n    },\n\n    updateCategory(category, dialog) {\n      if (!this.$refs.popupCategoryUpdateForm.validate()) {\n        return\n      }\n\n      PopupCategoryApi.save(category).then(() => {\n        this.search();\n      });\n\n      dialog.value = false\n    },\n\n    deleteCategory(data) {\n      if (confirm('삭제 하시겠습니까?')) {\n        PopupCategoryApi.delete(data.id).then(() => {\n          this.search();\n        });\n      }\n    }\n\n  },\n  created() {\n\n    let storedParams = this.$store.getters?.params??{};\n\n    // first load\n    if(!storedParams.name || storedParams.name !== this.$options.name) {\n      this.options = {\n        page:1,\n        itemsPerPage:10,\n        categoryId:null,\n        name:this.$options.name\n      }\n\n      storedParams = this.options\n      this.$store.commit('setParams', storedParams)\n\n    } else {\n      storedParams.name = this.$options.name\n      this.options = storedParams\n    }\n\n    this.selectedCategory = this.options.categoryId ? [{id:this.options.categoryId}] : []\n    this.search(this.options.categoryId, _.cloneDeep(storedParams))\n\n  }\n\n};\n</script>\n\n<style scoped>\n.dbTable td{\n  text-align: center;\n  font-size: 30px;\n}\n.popupButton{\n  margin :auto;\n  margin-left: 0.3rem !important;\n  margin-right: 0.3rem !important;\n}\n.popupCategoryBtn{\n  margin-left:-1.5rem;\n}\n</style>\n"]}]}